<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Absicherung von Microservices mit OpenID Connect und Spring Security 5</title>
        <meta name="description" content="OAuth 2.0 and OpenID Connect @ OWASP Munich">
        <meta name="author" content="Andreas Falk">

		<link rel="stylesheet" href="css/reset.css">
		<link rel="icon" href="images/cropped-novatec-favicon-32x32.png" sizes="32x32" />
        <link rel="icon" href="images/cropped-novatec-favicon-192x192.png" sizes="192x192" />


        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="stylesheet" href="css/reset.css">
        <link rel="stylesheet" href="css/reveal.css">
        <link rel="stylesheet" href="css/theme/novatec.css" id="theme">
        <!--link rel="stylesheet" href="css/theme/white.css" id="theme"-->

        <!-- Theme used for syntax highlighting of code -->
        <link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">

                <!-- Title, Speaker and Workshop Introduction -->
                <section>
                    <section>
                        <h3>Absicherung von Microservices mit OpenID Connect und Spring Security 5</h3>
                        <img src="images/jax_logo_2019.png" class="plain">
                        <p>JAX, Mainz 7.5.2019</p>
                        <p>
                            <small>
                            <a href="https://andifalk.github.io/jax-2019-openid-connect-spring-security/index.html">Slides: https://andifalk.github.io/jax-2019-openid-connect-spring-security/index.html</a><br>
                            <a href="https://github.com/andifalk/jax-2019-openid-connect-spring-security">Demos: https://github.com/andifalk/jax-2019-openid-connect-spring-security</a>
                            </small>
                        </p>
                    </section>
                    <section data-background-color="white">
                        <img src="images/andreas_falk.jpg" class="plain" width="35%">
                        <h4>Andreas Falk</h4>
                        <small>
                            <p><strong>Novatec Consulting GmbH</strong></p>
                            </p>andreas.falk@novatec-gmbh.de / @andifalk (Twitter)<br>
                            <br><a href="https://www.novatec-gmbh.de/">https://www.novatec-gmbh.de</a><br>
                            <img src="images/novatec_logo_big.png" class="plain" width="40%">
                        </small>
                    </section>
                    <section>
                        <h1>Agenda</h1>
                        <p>Intro to OAuth 2.0 & OpenID Connect 1.0</p>
                        <p>Current Discussions & Best Practices in OAuth 2.0/OIDC</p>
                        <p>OAuth 2 & OIDC with Spring Security 5 (Live Demo)</p>
                    </section>
                </section>

                <!-- OAuth 2 101 -->

                <section>
                    <section>
                        <h1>OAuth 2.0</h1>
                        <h2>101</h2>
                        <p>
                            <a href="https://tools.ietf.org/html/rfc6749">RFC 6749: The OAuth 2.0 Authorization Framework</a><br>
                            <a href="https://tools.ietf.org/html/rfc6750">RFC 6750: OAuth 2.0 Bearer Token Usage</a><br>
                            <a href="https://tools.ietf.org/html/rfc6819">RFC 6819: OAuth 2.0 Threat Model and Security Considerations</a>
                        </p>
                    </section>
                    <section>
                        <h2>What is OAuth 2.0?</h2>
                        <p>
                            OAuth 2.0 is an authorization delegation framework<br>
                        </p>
                        <img src="images/Valet_Ferrari.png" class="plain" width="70%">
                    </section>
                    <section>
                        <h3>OAuth 2.0 Model</h3>
                        <img src="images/oauth2_protocol.png" class="plain">
                    </section>
                    <section>
                        <h3>OAuth 2.0 Grant Flows</h3>
                        <table style="font-size: smaller">
                            <thead>
                            <tr>
                                <th>Client Type</th>
                                <th>Flow</th>
                                <th>Refresh Tokens</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td>Confidential</td>
                                <td>Authorization Code</td>
                                <td>X</td>
                            </tr>
                            <tr>
                                <td>Public (Native)</td>
                                <td>Authorization Code (PKCE)</td>
                                <td>X</td>
                            </tr>
                            <tr>
                                <td>Public (SPA)</td>
                                <td>Implicit</td>
                                <td>--</td>
                            </tr>
                            <tr>
                                <td>Trusted</td>
                                <td>RO Password Creds</td>
                                <td>X</td>
                            </tr>
                            <tr>
                                <td>No Resource Owner</td>
                                <td>Client Credentials</td>
                                <td>--</td>
                            </tr>
                            </tbody>
                        </table>
                    </section>
                    <section>
                        <h4>Authorization Code Grant Flow</h4>
                        <img src="images/authorization_code_schema.png" class="plain" width="100%">
                    </section>
                    <!--
                    <section>
                        <h3>Authorization Request</h3>
                        <p class="fragment highlight-current-blue" style="text-align: left">GET https://authserver.example.com/authorize</p>
                        <p class="fragment highlight-current-blue" style="text-align: left; margin-left: 100px;">?response_type=code</p>
                        <p class="fragment highlight-current-blue" style="text-align: left; margin-left: 100px;">&client_id=abcdefg</p>
                        <p class="fragment highlight-current-blue" style="text-align: left; margin-left: 100px;">&redirect_uri=https://client.abc.com/callback</p>
                        <p class="fragment highlight-current-blue" style="text-align: left; margin-left: 100px;">&scope=api.read api.write</p>
                        <p class="fragment highlight-current-blue" style="text-align: left; margin-left: 100px;">&state=xyz</p>
                    </section>
                    <section>
                        <h3>Authorization Response</h3>
                        <p style="text-align: left">HTTP/1.1 302 Found</p>
                        <p style="text-align: left">Location: https://client.abc.com/callback</p>
                        <p class="fragment highlight-current-blue" style="text-align: left; margin-left: 200px;">?code=ab23bhW56Xb</p>
                        <p class="fragment highlight-current-blue" style="text-align: left; margin-left: 200px;">&state=xyz</p>
                    </section>
                    <section>
                        <h4>Token Request (Basic Auth)</h4>
                        <p><small>Client-Id=123, Client-Secret=456, Base64(123:456)="MTIzOjQ1Ng=="</small></p>
                        <p class="fragment highlight-current-blue" style="text-align: left">POST https://authserver.example.com/token</p>
                        <p class="fragment highlight-current-blue" style="text-align: left; margin-left: 60px;">Content-Type: <br>application/x-www-form-urlencoded</p>
                        <p class="fragment highlight-current-blue" style="text-align: left; margin-left: 60px;">Authorization: Basic MTIzOjQ1Ng==</p>
                        <p>&nbsp;</p>
                        <p class="fragment highlight-current-blue" style="text-align: left; margin-left: 60px;">grant_type=authorization_code&code=ab23bhW56Xb</p>
                        <p class="fragment highlight-current-blue" style="text-align: left; margin-left: 60px;">&redirect_uri=https://client.abc.com/callback</p>
                    </section>
                    <section>
                        <h4>Token Request (Body)</h4>
                        <p><small>Client-Id=123, Client-Secret=456</small></p>
                        <p class="fragment highlight-current-blue" style="text-align: left">POST https://authserver.example.com/token</p>
                        <p class="fragment highlight-current-blue" style="text-align: left; margin-left: 60px;">Content-Type: <br>application/x-www-form-urlencoded</p>
                        <p>&nbsp;</p>
                        <p class="fragment highlight-current-blue" style="text-align: left; margin-left: 60px;">grant_type=authorization_code&code=ab23bhW56Xb</p>
                        <p class="fragment highlight-current-blue" style="text-align: left; margin-left: 60px;">&redirect_uri=https://client.abc.com/callback</p>
                        <p class="fragment highlight-current-blue" style="text-align: left; margin-left: 60px;">&client_id=123&client_secret=456</p>
                    </section>
                    <section>
                        <h4>Token Response</h4>
                        <pre><code class="json" data-trim>
                             HTTP/1.1 200 OK
                             Content-Type: application/json;charset=UTF-8

                             {
                               "access_token":"2YotnFZFEjr1zCsicMWpAA",
                               "token_type":"bearer",
                               "expires_in":3600,
                               "refresh_token":"tGzv3JOkF0XG5Qx2TlKWIA"
                             }
                        </code></pre>
                    </section>
                    -->
                    <section>
                        <h2>Demo Time</h2>
                        <h3>Authorization Code Grant Flow</h3>
                        <h3>In Action</h3>
                    </section>
                    <section>
                        <h4>Implicit Grant Flow</h4>
                        <img src="images/implicit_schema.png" class="plain" >
                    </section>
                    <section>
                        <h3>Authorization Request</h3>
                        <p class="fragment highlight-current-blue" style="text-align: left">GET https://authserver.example.com/authorize</p>
                        <p class="fragment highlight-current-blue" style="text-align: left; margin-left: 100px;">?response_type=token</p>
                        <p class="fragment highlight-current-blue" style="text-align: left; margin-left: 100px;">&client_id=abcdefg</p>
                        <p class="fragment highlight-current-blue" style="text-align: left; margin-left: 100px;">&redirect_uri=https://client.abc.com/callback</p>
                        <p class="fragment highlight-current-blue" style="text-align: left; margin-left: 100px;">&scope=api.read api.write</p>
                        <p class="fragment highlight-current-blue" style="text-align: left; margin-left: 100px;">&state=xyz</p>
                    </section>
                    <section>
                        <h3>Authorization Response</h3>
                        <p style="text-align: left">HTTP/1.1 302 Found</p>
                        <p style="text-align: left">Location: https://client.abc.com/callback</p>
                        <p class="fragment highlight-current-blue" style="text-align: left; margin-left: 200px;">#access_token=2YotnFZFEjr1zCsicMWpAA</p>
                        <p class="fragment highlight-current-blue" style="text-align: left; margin-left: 200px;">&token_type=bearer</p>
                        <p class="fragment highlight-current-blue" style="text-align: left; margin-left: 200px;">&expires_in=3600</p>
                        <p class="fragment highlight-current-blue" style="text-align: left; margin-left: 200px;">&scope=api.read api.write</p>
                        <p class="fragment highlight-current-blue" style="text-align: left; margin-left: 200px;">&state=xyz</p>
                    </section>
                </section>

                <!-- OpenID Connect 1.0 -->
                <section>
                    <section>
                        <h2>OpenID Connect 1.0</h2>
                        <h2>(OIDC)</h2>
                        <h2>101</h2>
                        <small>
                            <p>
                                <a href="https://openid.net/specs/openid-connect-core-1_0.html">OpenID Connect Core 1.0</a><br>
                                <a href="https://openid.net/specs/openid-connect-registration-1_0.html">OpenID Connect Dynamic Client Registration 1.0</a><br>
                                <a href="https://openid.net/specs/openid-connect-discovery-1_0.html">OpenID Connect Discovery 1.0</a>
                            </p>
                        </small>
                    </section>
                    <section>
                        <h3>OpenID Connect 1.0 is for Authentication</h3>
                        <img src="images/manico_tweet_oauth2_not_authentication.png" class="plain" width="100%">
                        <p>
                            <small>
                                <a href="https://oauth.net/articles/authentication/">OAuth 2.0 is not an authentication protocol</a>
                            </small>
                        </p>
                    </section>
                    <section>
                        <h3>OIDC Model</h3>
                        <img src="images/oidc_roles.png" class="plain" width="70%">
                    </section>
                    <section>
                        <h3>Additions to OAuth 2.0</h3>
                        <p class="fragment highlight-current-blue">Id Token (JWT format)</p>
                        <p class="fragment highlight-current-blue">User Info Endpoint</p>
                        <p class="fragment highlight-current-blue">Standard Scopes</p>
                        <p class="fragment highlight-current-blue">Hybrid Grant Flow</p>
                        <p class="fragment highlight-current-blue">OpenID Provider Configuration Information</p>
                    </section>
                    <section>
                        <h3>ID Token</h3>
                        <h4>JSON Web token (JWT)</h4>
                        <p>Base 64 Encoded JSON Formatted Value of...</p>
                        <p class="fragment">...Header</p>
                        <p class="fragment">...Payload</p>
                        <p class="fragment">...Signature</p>
                        <pre><code class="http" data-trim>
                            GET / HTTP/1.1
                            Host: localhost:8080
                            Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1N...
                        </code></pre>
                        <small>
                            <ul>
                                <li><a href="https://tools.ietf.org/html/rfc7519">RFC 7519: JSON Web Token (JWT)</a></li>
                                <li><a href="https://tools.ietf.org/html/draft-ietf-oauth-jwt-bcp">JSON Web Token Best Current Practices</a></li>
                                <li><a href="https://tools.ietf.org/html/draft-ietf-oauth-proof-of-possession">Proof-of-Possession Key Semantics for JSON Web Tokens (JWTs)</a></li>
                            </ul>
                        </small>
                    </section>
                    <section>
                        <h3>JSON Web Token (JWT)</h3>
                        <p>Header</p>
                        <pre><code class="json" data-trim>
                            {
                              typ: "JWT",
                              alg: "RS256"
                            }
                        </code></pre>
                        <p>Payload</p>
                        <pre><code class="json" data-trim>
                            {
                              iss: "https://identity.example.com",
                              aud: "my-client-id",
                              exp: 1495782385,
                              nonce: "N0.46824857243233511495739124749",
                              iat: 1495739185,
                              at_hash: "hC1NDSB8WZ9SnjXTid175A",
                              sub: "mysubject",
                              auth_time: 1495739185,
                              email: "test@gmail.com"
                            }
                        </code></pre>
                    </section>
                    <section>
                        <h2>ID Token Claims</h2>
                        <table style="font-size: smaller">
                            <thead>
                            <tr>
                                <th>Scope</th>
                                <th>Required</th>
                                <th>Description</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td>iss</td>
                                <td>X</td>
                                <td>Issuer Identifier</td>
                            </tr>
                            <tr>
                                <td>sub</td>
                                <td>X</td>
                                <td>Subject Identifier</td>
                            </tr>
                            <tr>
                                <td>aud</td>
                                <td>X</td>
                                <td>Audience(s) of this ID Token</td>
                            </tr>
                            <tr>
                                <td>exp</td>
                                <td>X</td>
                                <td>Expiration time</td>
                            </tr>
                            <tr>
                                <td>iat</td>
                                <td>X</td>
                                <td>Time at which the JWT was issued</td>
                            </tr>
                            <tr>
                                <td>auth_time</td>
                                <td>(X)</td>
                                <td>Time of End-User authentication</td>
                            </tr>
                            <tr>
                                <td>nonce</td>
                                <td>--</td>
                                <td>Associate a client with an ID Token</td>
                            </tr>
                            </tbody>
                        </table>
                    </section>
                    <section>
                        <h2>Token Validation</h2>
                        <p>
                            <img src="images/token_validation.png" class="plain">
                        </p>
                    </section>
                    <section>
                        <h2>User Info Endpoint</h2>
                        <pre><code class="http" data-trim>
                            GET /userinfo HTTP/1.1
                            Host: identityserver.example.com
                            Authorization: Bearer SlAV32hkKG
                        </code></pre>
                        <pre><code class="http" data-trim>
                            HTTP/1.1 200 OK
                            Content-Type: application/json

                            {
                             "sub": "248289761001",
                             "name": "Jane Doe",
                             "given_name": "Jane",
                             "family_name": "Doe",
                             "preferred_username": "j.doe",
                             "email": "janedoe@example.com",
                             "picture": "http://example.com/janedoe/me.jpg"
                            }
                        </code></pre>
                    </section>
                    <section>
                        <h3>OpenID Connect 1.0 Configuration</h3>
                        <p>https://example.com/.well-known/openid-configuration</p>
                        <pre><code class="json" data-trim>
                            {
                              "authorization_endpoint": "https://idp.example.com/auth",
                              "grant_types_supported": [
                                  "authorization_code",
                                  "implicit",
                                  "refresh_token"
                              ],
                              "issuer": "https://idp.example.com",
                              "jwks_uri": "https://idp.example.com/keys",
                              "token_endpoint": "https://idp.example.com/token",
                              "userinfo_endpoint": "https://idp.example.com/userinfo",
                              ...
                            }
                        </code></pre>
                        <p>
                            <small>
                                <a href="https://openid.net/specs/openid-connect-discovery-1_0.html">OpenID Connect Discovery 1.0</a>
                            </small>
                        </p>
                    </section>
                </section>

                <!-- OAuth Security Workshop Stuttgart -->
                <section>
                    <section>
                        <h2>Discussions & Best Practices</h2>
                        <h2>In OAuth 2.0 and OpenID Connect</h2>
                    </section>
                    <section>
                        <h4>4th OAuth Security Workshop 2019</h4>
                        <p>Stuttgart</p>
                        <p>
                            <img src="images/osw2019picture.jpg" class="plain" width="70%">
                        </p>
                        <p>
                            <small>
                                <a href="https://sec.uni-stuttgart.de/events/osw2019">https://sec.uni-stuttgart.de/events/osw2019</a>
                            </small>
                        </p>
                    </section>
                    <section>
                        <img src="images/why_not_use_implicit_grant.png" class="plain" width="50%">
                        <br><small><a href="https://medium.com/oauth-2/why-you-should-stop-using-the-oauth-implicit-grant-2436ced1c926">https://medium.com/oauth-2/why-you-should-stop-using-the-oauth-implicit-grant-2436ced1c926</a></small>
                    </section>
                    <section>
                        <h3>OAuth 2.0 Security Best Current Practice</h3>
                        <p>Torsten Lodderstedt and Daniel Fett</p>
                        <img src="images/d_fett_sbp.jpeg" class="plain" width="50%">
                        <p><small><a href="https://tools.ietf.org/html/draft-ietf-oauth-security-topics">OAuth 2.0 Security Best Current Practice</a></small></p>
                    </section>
                    <section>
                        <h3>Implicit Flow Attacks</h3>
                        <img src="images/oauth_implicit_grant_attacks_d_fett.png" class="plain" width="100%">
                        <br><small>Source: Torsten Lodderstedt and Daniel Fett</small>
                    </section>
                    <section>
                        <h3>OAuth 2.0 for Browser-Based Apps</h3>
                        <p>David Waite (PingFederate)</p>
                        <img src="images/oauth_browser_apps_d_waite.jpeg" class="plain" width="50%">
                        <p><small><a href="https://tools.ietf.org/html/draft-ietf-oauth-browser-based-apps">OAuth 2.0 for Browser-Based Apps</a></small></p>
                    </section>
                    <section>
                        <h3>OAuth 2.0 for Browser-Based Apps</h3>
                        <p>Content-Security Policy</p>
                        <p>Use a unique redirect URI</p>
                        <p>Do NOT use refresh tokens</p>
                        <p><small><a href="https://tools.ietf.org/html/draft-ietf-oauth-browser-based-apps">OAuth 2.0 for Browser-Based Apps</a></small></p>
                    </section>
                    <section>
                        <h3>Other Known OAuth 2.0 Attacks</h3>
                        <ul>
                            <li>Lack of CSRF protection</li>
                            <li>Authorization code leakage and replay</li>
                            <li>Authorization code injection</li>
                            <li>Open Re-directors</li>
                            <li>State leakage and replay</li>
                            <li>Insufficient Redirect URI matching</li>
                            <li>Too powerful access tokens</li>
                            <li>Mix-Up Attacks</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Open Redirect !!</h2>
                        <img src="images/openredirector_spring_security.png" class="plain">
                    </section>
                    <section>
                        <h3>&ldquo;OAuth 2.1&rdquo; Grant Flows</h3>
                        <table style="font-size: smaller">
                            <thead>
                            <tr>
                                <th>Client Type</th>
                                <th>Flow</th>
                                <th>Refresh Tokens</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td>Confidential</td>
                                <td style="font-weight: bold">Authorization Code (PKCE)</td>
                                <td>X</td>
                            </tr>
                            <tr>
                                <td>Public (Native)</td>
                                <td>Authorization Code (PKCE)</td>
                                <td>X</td>
                            </tr>
                            <tr>
                                <td>Public (SPA)</td>
                                <td style="font-weight: bold">Authorization Code (PKCE)</td>
                                <td>--</td>
                            </tr>
                            <tr style="text-decoration: line-through;">
                                <td>Trusted</td>
                                <td>RO Password Creds</td>
                                <td>X</td>
                            </tr>
                            <tr>
                                <td>No Resource Owner</td>
                                <td>Client Credentials</td>
                                <td>--</td>
                            </tr>
                            </tbody>
                        </table>
                    </section>
                    <section>
                        <h2>Proof Key for Code Exchange by OAuth Public Clients (PKCE)</h2>
                        <p>(&ldquo;Pixy&rdquo;)</p>
                        <p>Mitigates authorization code attacks</p>
                        <p>Mitigates token leakage in SPAs</p>
                        <p>
                            <small>
                                <a href="https://tools.ietf.org/html/rfc7636">Proof Key for Code Exchange by OAuth Public Clients</a>
                            </small>
                        </p>
                    </section>
                    <section>
                        <h3>PKCE - Authorization Request</h3>
                        <p style="text-align: left">GET https://authserver.example.com/authorize</p>
                        <p style="text-align: left; margin-left: 100px;">?response_type=code</p>
                        <p style="text-align: left; margin-left: 100px;">&client_id=abcdefg</p>
                        <p style="text-align: left; margin-left: 100px;">&redirect_uri=https://client.abc.com/callback</p>
                        <p style="text-align: left; margin-left: 100px;">&scope=api.read api.write</p>
                        <p style="text-align: left; margin-left: 100px;">&state=xyz</p>
                        <p style="text-align: left; margin-left: 100px; color: red;">&code_challenge=xyz...&code_challenge_method=S256</p>
                    </section>
                    <section>
                        <h4>PKCE - Token Request</h4>
                        <p><small>Client-Id=123, Client-Secret=456</small></p>
                        <p style="text-align: left">POST https://authserver.example.com/token</p>
                        <p style="text-align: left; margin-left: 60px;">Content-Type: <br>application/x-www-form-urlencoded</p>
                        <p style="text-align: left; margin-left: 60px;">grant_type=authorization_code&code=ab23bhW56Xb</p>
                        <p style="text-align: left; margin-left: 60px;">&redirect_uri=https://client.abc.com/callback</p>
                        <p style="text-align: left; margin-left: 60px;">&client_id=123&client_secret=456</p>
                        <p style="text-align: left; margin-left: 60px; color: red;">&code_verifier=4gth4jn78k_8</p>
                    </section>
                    <section>
                        <h3>Steal Tokens via XSS</h3>
                        <p>&ldquo;XSS is Game-Over for OAuth 2&rdquo; (Jim Manico)</p>
                        <img src="images/manico_xss_local_storage.jpeg" class="plain" width="60%">
                    </section>
                    <section>
                        <h3>OAuth 2 Access Token JWT Profile</h3>
                        <p>Vittorio Bertocci (Auth0)</p>
                        <img src="images/vittorio_jwt.jpeg" class="plain" width="60%">
                        <p>
                            <small>
                                <a href="https://tools.ietf.org/html/draft-ietf-oauth-access-token-jwt">JSON Web Token (JWT) Profile for OAuth 2.0 Access Tokens</a>
                            </small>
                        </p>
                    </section>
                    <section>
                        <h3>OAuth 2 Access Token JWT Profile</h3>
                        <p>Required claims: iss, exp, aud, sub, client_id</p>
                        <p>Consider privacy restrictions for identity claims</p>
                        <p>Authorization claims according to SCIM Core (RFC7643):</p>
                        <ul>
                            <li>Groups</li>
                            <li>Entitlements</li>
                            <li>Roles</li>
                        </ul>
                        <p>
                            <small>
                                <a href="https://tools.ietf.org/pdf/rfc7643.pdf">System for Cross-domain Identity Management (SCIM)</a>
                            </small>
                        </p>
                    </section>
                    <section>
                        <h3>Token Binding</h3>
                        <p style="text-decoration: line-through"><a href="https://tools.ietf.org/html/rfc8471">RFC8471: The Token Binding Protocol Version 1.0</a></p>
                        <p style="text-decoration: line-through"><a href="https://tools.ietf.org/html/rfc8472">RFC8472: (TLS) Extension for Token Binding Protocol Negotiation</a></p>
                        <p style="text-decoration: line-through"><a href="https://tools.ietf.org/html/rfc8473">RFC8473: Token Binding over HTTP</a></p>
                        <p><a href="https://tools.ietf.org/html/draft-ietf-oauth-mtls">OAuth 2.0 Mutual TLS Client Authentication and Certificate-Bound Access Tokens</a></p>
                        <p>
                            <small>
                                <a href="https://groups.google.com/a/chromium.org/forum/#!msg/blink-dev/OkdLUyYmY1E/w2ESAeshBgAJ">Google - Intent to Remove: Token Binding</a>
                            </small>
                        </p>
                    </section>
                    <section>
                        <h2>Further Internet-Drafts for OAuth 2</h2>
                        <p><a href="https://tools.ietf.org/id/draft-*-oauth-?maxhits=100&key=date&dir=desc">List of OAuth 2 Internet-Drafts (by date)</a></p>
                    </section>
                </section>


                <!-- Spring Security Live Demo -->
                <section>
                    <section>
                        <h2>Demo Time</h2>
                        <h3>OAuth 2.0 & OpenID Connect 1.0</h3>
                        <h3>With Spring Security 5</h3>
                        <img src="images/spring-logo.png" class="plain">
                    </section>
                    <section>
                        <h2>&ldquo;Legacy&rdquo; Spring Security OAuth 2 Stack</h2>
                        <img src="images/spring_security_old.png" class="plain">
                    </section>
                    <section>
                        <h2>&ldquo;New&rdquo; Spring Security <br> OAuth 2 Stack</h2>
                        <img src="images/spring_security_new.png" class="plain">
                    </section>
                    <section>
                        <h2>Demo application</h2>
                        <img src="images/demo-architecture.png" class="plain" width="100%">
                    </section>
                    <section>
                        <h3>What's new in <br>Spring Security<br>5.2 & 5.3</h3>
                        <p>
                            <img src="images/spring_security_5_2.png" class="plain" width="70%">
                        </p>
                    </section>
                    <section>
                        <h2>Spring Security 5.2 (08/2019)</h2>
                        <ul>
                            <li><a href="https://github.com/spring-projects/spring-security/issues/6446">Client Support for PKCE</a></li>
                            <li><a href="https://github.com/spring-projects/spring-security/issues/5350">OpenID Connect RP-Initiated Logout</a></li>
                            <li><a href="https://github.com/spring-projects/spring-security/issues/5200">Support for OAuth 2.0 Token Introspection</a></li>
                            <li><a href="https://github.com/spring-projects/spring-security/issues/5351">Resource Server Multi-tenancy (Servlet & Reactive)</a></li>
                            <li><a href="https://github.com/spring-projects/spring-security/issues/5465">Use symmetric keys with JwtDecoder</a></li>
                            <li><a href="https://github.com/spring-projects/spring-security/issues/6634">JWT Flow API in Test Support</a></li>
                        </ul>
                        <p>
                            <small>
                                <a href="https://github.com/spring-projects/spring-security/milestone/132">Spring Security 5.2.0 M2 GitHub Issues</a><br>
                                <a href="https://github.com/spring-projects/spring-security/milestone/141">Spring Security 5.2.0 M3 GitHub Issues</a><br>
                                <a href="https://github.com/spring-projects/spring-security/milestone/142">Spring Security 5.2.0 RC1 GitHub Issues</a><br>
                            </small>
                        </p>
                    </section>
                    <section>
                        <h3>OAuth 2.0 Token Introspection</h3>
                        <p>Opaque Tokens</p>
                        <pre><code class="java" data-trim>
                            class ResSrvConfig extends WebSecurityConfigurerAdapter {

                                @Override
                                protected void configure(HttpSecurity http)
                                        throws Exception {
                                    http.oauth2ResourceServer()
                                            .opaqueToken()
                                                .introspectionUri(this.introspectionUri)
                                                .introspectionClientCredentials(
                                                    this.clientId, this.clientSecret);
                                }
                            }
                        </code></pre>
                        <small>
                            <a href="https://github.com/spring-projects/spring-security/issues/5200">https://github.com/spring-projects/spring-security/issues/5200</a>
                        </small>
                    </section>
                    <section>
                        <h3>Resource Server Multi-tenancy</h3>
                        <pre><code class="java" data-trim>
                            class ResSrvConfig extends WebSecurityConfigurerAdapter {

                                @Override protected void configure(HttpSecurity http) {
                                    http.oauth2ResourceServer()
                                        .authenticationManagerResolver(
                                            multitenantAuthenticationManager());
                                }

                                @Bean AuthenticationManagerResolver&lt;HttpServletRequest&gt;
                                    multiTenantAuthMgr() {...}

                                AuthenticationManager jwt() {...}
                                AuthenticationManager opaque() {...}
                            }
                        </code></pre>
                        <small>
                            <a href="https://github.com/spring-projects/spring-security/issues/5351">https://github.com/spring-projects/spring-security/issues/5351</a><br>
                            <a href="https://github.com/spring-projects/spring-security/issues/6727">https://github.com/spring-projects/spring-security/issues/6727</a>
                        </small>
                    </section>
                    <section>
                        <h4>Use symmetric keys with JwtDecoder</h4>
                        <pre><code class="java" data-trim>
                            class ResSrvConfig extends WebSecurityConfigurerAdapter {

                              @Value("${spring.security.oauth2.resourceserver.
                                            jwt.key-value}") RSAPublicKey key;

                              @Override protected void configure(HttpSecurity http) {
                                http.oauth2ResourceServer().jwt().decoder(jwtDecoder());
                              }

                              @Bean JwtDecoder jwtDecoder() throws Exception {
                                  return NimbusJwtDecoder.
                                          withPublicKey(this.key).build();
                              }
                            }
                        </code></pre>
                        <small>
                            <a href="https://github.com/spring-projects/spring-security/issues/5465">https://github.com/spring-projects/spring-security/issues/5465</a>
                        </small>
                    </section>
                    <section>
                        <h4>JWT Flow API in Test Support</h4>
                        <pre><code class="java" data-trim>
                            public class OAuth2ResourceServerTest {

                                @Test
                                public void testRequestPostProcessor() {
                                  mockMvc.perform(get("/message")
                                  .with(mockAccessToken().scope("message:read")))
                                  .andExpect(status().isOk())

                                  mockMvc.perform(get("/")
                                  .with(jwt().claim(SUB, "the-subject")))
                                  .andExpect(status().isOk())
                                }
                            }
                        </code></pre>
                        <small>
                            <a href="https://github.com/spring-projects/spring-security/issues/6634">https://github.com/spring-projects/spring-security/issues/6634</a>
                        </small>
                    </section>
                    <section>
                        <h2>Spring Security 5.3</h2>
                        <p><a href="https://github.com/spring-projects/spring-security/issues/6320">Support OAuth 2.0 Authorization Server:</a></p>
                        <ul>
                            <li>OAuth 2.0 Authorization Code Grant</li>
                            <li>OpenID Connect 1.0 (Authorization Code Flow)</li>
                            <li>PKCE</li>
                            <li>OAuth 2.0 Client Credentials Grant</li>
                            <li>JWT Access Token format</li>
                            <li>JWK Set Endpoint</li>
                            <li>Opaque Access Token format</li>
                            <li>OAuth 2.0 Token Revocation</li>
                        </ul>
                        <p><small><a href="https://github.com/spring-projects/spring-security/milestone/136">Spring Security 5.3.0 GitHub Issues</a></small></p>
                    </section>
                </section>

                <!-- The End -->
                <section>
                    <section>
                        <h2>Book References</h2>
                        <img src="images/iron-glad-java.jpg" class="plain" width="24%">
                        <img src="images/devops-handbook.jpg" class="plain" width="20%">
                        <img src="images/oauth2_in_action.jpg" class="plain" width="24%">
                        <img src="images/agile-security-book.jpg" class="plain" width="24%">
                    </section>
                    <section>
                        <h1>Q&A</h1>
                        <a href="https://www.novatec-gmbh.de/">https://www.novatec-gmbh.de</a></br>
                        <a href="https://blog.novatec-gmbh.de/">https://blog.novatec-gmbh.de</a><br>
                        andreas.falk@novatec-gmbh.de<br>
                        Twitter: @andifalk<br>
                    </section>
                    <section>
                        <h2>Online References</h2>
                        <small>
                            <ul>
                                <li><a href="https://tools.ietf.org/html/rfc6749">RFC 6749: The OAuth 2.0 Authorization Framework</a></li>
                                <li><a href="https://tools.ietf.org/html/rfc6750">RFC 6750: OAuth 2.0 Bearer Token Usage</a></li>
                                <li><a href="https://tools.ietf.org/html/rfc6819">RFC 6819: OAuth 2.0 Threat Model and Security Considerations</a></li>
                                <li><a href="http://tools.ietf.org/html/rfc7636">RFC 7636: Proof Key for Code Exchange (&ldquo;Pixy&rdquo;)</a></li>
                                <li><a href="https://openid.net/specs/openid-connect-core-1_0.html">OpenID Connect Core 1.0</a></li>
                                <li><a href="https://openid.net/specs/openid-connect-registration-1_0.html">OpenID Connect Dynamic Client Registration 1.0</a></li>
                                <li><a href="https://openid.net/specs/openid-connect-discovery-1_0.html">OpenID Connect Discovery 1.0</a></li>
                                <li><a href="https://tools.ietf.org/html/rfc7519">RFC 7519: JSON Web Token (JWT)</a></li>
                                <li><a href="https://tools.ietf.org/html/draft-ietf-oauth-jwt-bcp">JSON Web Token Best Current Practices</a></li>
                                <li><a href="https://sec.uni-stuttgart.de/events/osw2019">4. OAuth Security Workshop 2019 event web page</a></li>
                                <li><a href="https://medium.com/oauth-2/why-you-should-stop-using-the-oauth-implicit-grant-2436ced1c926">Why you should stop using the OAuth implicit grant</a></li>
                                <li><a href="https://tools.ietf.org/html/draft-ietf-oauth-security-topics">OAuth 2.0 Security Best Current Practice</a></li>
                                <li><a href="https://tools.ietf.org/html/draft-ietf-oauth-browser-based-apps-01">OAuth 2.0 for Browser-Based Apps</a></li>
                                <li><a href="https://tools.ietf.org/html/draft-ietf-oauth-mtls">OAuth 2.0 Mutual TLS Client Authentication and Certificate-Bound Access Tokens</a></li>
                                <li><a href="https://tools.ietf.org/html/draft-ietf-oauth-access-token-jwt">JSON Web Token (JWT) Profile for OAuth 2.0 Access Tokens</a></li>
                                <li><a href="https://spring.io/projects/spring-security">Spring Security</a></li>
                            </ul>
                            <p>All images used are from <a href="https://pixabay.com/">Pixabay</a> and are published under <a href="http://creativecommons.org/publicdomain/zero/1.0/deed.en">Creative Commons CC0 license.</a></p>
                            All used logos are trademarks of respective companies
                        </small>
                    </section>
                </section>
			</div>
		</div>

		<script src="js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
                hash: true,
                fragmentInURL: false,
                dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
                    { src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true }
				]
			});
            Reveal.configure({
                slideNumber: 'c/t',
                pdfMaxPagesPerSlide: 1
            });
		</script>
	</body>
</html>
